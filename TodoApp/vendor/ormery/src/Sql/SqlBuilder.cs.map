{ "version": 3, "file": "csharp/ormery/src/Sql/SqlBuilder.cs", "sources": [ "-work/src/sql/builder.temper.md" ], "sourcesContent": [ "# SQL Query Builder\n\n## The `sql` tag\n\nThis builds a semi-structured *SqlFragment* representation that then can have\nvalues rendered for various DB dialects.\n\nTODO Would it be possible to extract a \u0022prepared statement\u0022 form as well? Could\nthat be recognized and cached instead of rebuilt each time?\n\n    export let sql = SqlBuilder;\n\n    export class SqlBuilder {\n      private let buffer: ListBuilder\u003cSqlPart\u003e = new ListBuilder();\n\n### appendSafe\n\n      public appendSafe(sqlSource: String): Void {\n        buffer.add(new SqlSource(sqlSource));\n      }\n\n### appendSqlFragment\n\nAdd the contents of another SQL fragment to this one.\n\n      @overload(\u0022append\u0022)\n      public appendFragment(fragment: SqlFragment): Void {\n        buffer.addAll(fragment.parts);\n      }\n\n### appendSqlPart\n\nAdd a single already qualified SQL part to this builder.\n\n      @overload(\u0022append\u0022)\n      public appendPart(part: SqlPart): Void {\n        buffer.add(part);\n      }\n\n### appendSqlPartList\n\n      @overload(\u0022append\u0022)\n      public appendPartList(values: List\u003cSqlPart\u003e): Void {\n        appendList(values) { (x: SqlPart) =\u003e appendPart(x) };\n      }\n\n### appendBoolean\n\n      @overload(\u0022append\u0022)\n      public appendBoolean(value: Boolean): Void {\n        buffer.add(new SqlBoolean(value));\n      }\n\n### appendBooleanList\n\n      @overload(\u0022append\u0022)\n      public appendBooleanList(values: Listed\u003cBoolean\u003e): Void {\n        appendList(values) { (x: Boolean) =\u003e appendBoolean(x) };\n      }\n\n### appendDate\n\nThe Temper date type naturally formats to YYYY-MM-DD, which is the standard SQL\ndate format.\n\n      @overload(\u0022append\u0022)\n      public appendDate(value: Date): Void {\n        buffer.add(new SqlDate(value));\n      }\n\n### appendDateList\n\n      @overload(\u0022append\u0022)\n      public appendDateList(values: Listed\u003cDate\u003e): Void {\n        appendList(values) { (x: Date) =\u003e appendDate(x) };\n      }\n\n### appendFloat64\n\n      @overload(\u0022append\u0022)\n      public appendFloat64(value: Float64): Void {\n        buffer.add(new SqlFloat64(value));\n      }\n\n### appendFloat64List\n\n      @overload(\u0022append\u0022)\n      public appendFloat64List(values: Listed\u003cFloat64\u003e): Void {\n        appendList(values) { (x: Float64) =\u003e appendFloat64(x) };\n      }\n\n### appendInt32\n\n      @overload(\u0022append\u0022)\n      public appendInt32(value: Int32): Void {\n        buffer.add(new SqlInt32(value));\n      }\n\n### appendInt32List\n\n      @overload(\u0022append\u0022)\n      public appendInt32List(values: Listed\u003cInt32\u003e): Void {\n        appendList(values) { (x: Int32) =\u003e appendInt32(x) };\n      }\n\n### appendInt64\n\n      @overload(\u0022append\u0022)\n      public appendInt64(value: Int64): Void {\n        buffer.add(new SqlInt64(value));\n      }\n\n### appendInt64List\n\n      @overload(\u0022append\u0022)\n      public appendInt64List(values: Listed\u003cInt64\u003e): Void {\n        appendList(values) { (x: Int64) =\u003e appendInt64(x) };\n      }\n\n### appendString\n\n      @overload(\u0022append\u0022)\n      public appendString(value: String): Void {\n        buffer.add(new SqlString(value));\n      }\n\n### appendStringList\n\n      @overload(\u0022append\u0022)\n      public appendStringList(values: Listed\u003cString\u003e): Void {\n        appendList(values) { (x: String) =\u003e appendString(x) };\n      }\n\n### appendList\n\nThis is a helper to make other list append methods easier.\n\n      private appendList\u003cT\u003e(values: Listed\u003cT\u003e, appendValue: Appender\u003cT\u003e): Void {\n        for (var i = 0; i \u003c values.length; i++) {\n          if (i \u003e 0) {\n            appendSafe(\u0022, \u0022);\n          }\n          appendValue(values[i]);\n        }\n      }\n\n### accumulated\n\nTODO Instead make some kind of Statement type.\n\n      public get accumulated(): SqlFragment {\n        new SqlFragment(buffer.toList())\n      }\n    }\n\n## Helper types\n\n    @fun interface Appender\u003cT\u003e(value: T): Void;\n" ], "names": [ "buffer", "appendSafe", "sqlSource", "t#1163", "appendFragment", "fragment", "t#1161", "appendPart", "part", "appendPartList", "values", "fn", "x", "appendList", "appendBoolean", "value", "t#1154", "appendBooleanList", "appendDate", "t#1148", "appendDateList", "appendFloat64", "t#1142", "appendFloat64List", "appendInt32", "t#1136", "appendInt32List", "appendInt64", "t#1130", "appendInt64List", "appendString", "t#1124", "appendStringList", "T", "appendValue", "t#1116", "t#1118", "i", "t#1113" ], "mappings": "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" }